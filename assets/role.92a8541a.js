import{f as D,r as l,ae as B,o as K,m as N,p as n,Q as r,B as I,aE as L,an as v,aV as w,cP as R,V as T}from"./index.062059f7.js";import{E as H}from"./dialog.00de49d5.js";import"./overlay.343072da.js";/* empty css               */import{E as P,a as U}from"./form-item.145b9d23.js";import{E as $}from"./tree.4e077dea.js";import{q,d as A}from"./role.f819e9d3.js";import{_ as M}from"./plugin-vue_export-helper.21dcd24c.js";import"./index.c076b86d.js";const Q={class:"form-tree"},S=v("\u53D6\u6D88"),j=v("\u786E\u5B9A"),z=D({__name:"role",emits:["refreshDataList"],setup(G,{expose:k,emit:h}){const u=l(!1),d=l([]),m=l([]),a=l(),i=l(),c=l(!1),t=B({id:"",permissionIds:[]}),y=o=>{u.value=!0,t.id=o||"",i.value&&i.value.resetFields(),a.value&&a.value.setCheckedKeys([]),o&&E(o)},f=()=>{d.value.forEach(o=>{o.permissionName==="\u7CFB\u7EDF\u9996\u9875"&&(o.disabled=!0,m.value=[o.id])})},E=o=>{q({roleId:o}).then(e=>{t.permissionIds=e.data.selectNode,d.value=e.data.tree,f(),m.value=e.data.selectNode})},C=o=>{a.value.setCheckedKeys(o?d.value.map(e=>e.id):[]),f()},p=()=>{i.value.validate(o=>{if(!o)return!1;console.log(a.value.getHalfCheckedKeys(),a.value.getCheckedKeys()),t.permissionIds=[...a.value.getCheckedKeys()],A(t).then(()=>{w.success({message:"\u64CD\u4F5C\u6210\u529F",duration:500,onClose:()=>{u.value=!1,h("refreshDataList")}})})})};return k({init:y}),(o,e)=>{const g=R,b=$,x=P,F=U,_=T,V=H;return K(),N(V,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=s=>u.value=s),title:t.id?"\u4FEE\u6539":"\u65B0\u589E","close-on-click-modal":!1},{footer:n(()=>[r(_,{onClick:e[2]||(e[2]=s=>u.value=!1)},{default:n(()=>[S]),_:1}),r(_,{type:"primary",onClick:e[3]||(e[3]=s=>p())},{default:n(()=>[j]),_:1})]),default:n(()=>[r(F,{ref_key:"dataFormRef",ref:i,model:t,"label-width":"120px",onKeyup:e[1]||(e[1]=L(s=>p(),["enter"]))},{default:n(()=>[r(x,{label:"\u83DC\u5355\u6743\u9650"},{default:n(()=>[r(g,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),label:"\u5168\u9009/\u5168\u4E0D\u9009",onChange:C},null,8,["modelValue"]),I("div",Q,[r(b,{ref_key:"menuListTree",ref:a,data:d.value,"default-checked-keys":m.value,props:{label:"permissionName",children:"childs"},"node-key":"id",accordion:"","show-checkbox":""},null,8,["data","default-checked-keys"])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}});var te=M(z,[["__scopeId","data-v-fddec30a"]]);export{te as default};
